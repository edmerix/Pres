class Presentation{constructor(e,t,i){this.frame=e,this.width=t,this.height=i,this.menu=document.createElement("menu"),this.menuHead=document.createElement("div"),this.menuHead.setAttribute("id","outlineHead"),this.menuHead.innerHTML="Poster outline",this.menu.appendChild(this.menuHead),this.frame.appendChild(this.menu),this.slides={},this.slideOrder=[],this.activeSlide=null,this.maxSlide=0,this.isRealSize=!1,this.isAutoPlaying=!1,this.autoHandle=null,this.countdownHandle=null,this.intervalSeconds=60,this.countdown=60,this.extraOffset=Math.max(2e3,this.width+100)}startup(){window.addEventListener("resize",()=>{this.resize()}),document.addEventListener("keydown",e=>{switch(e.key){case"ArrowLeft":case"ArrowUp":e.preventDefault(),this.previous();break;case"ArrowRight":case"ArrowDown":case" ":e.preventDefault(),this.advance();break;case"Escape":this.isAutoPlaying&&this.stop(),e.preventDefault();break;case"a":case"A":this.isAutoPlaying||this.autoplay(1e3*this.intervalSeconds);break;case"e":case"E":this.toggleExtra();break;case"z":case"Z":this.isRealSize?(this.isRealSize=!1,this.resize()):this.realSize();break;default:let t=/^[0-9]$/i.test(e.key);if(t){let i=parseInt(e.key)-1;i>=0&&i<this.slideOrder.length&&this.activate(this.slideOrder[i])}}}),this.resize()}async addSlide(e,t=this.slideOrder.length){console.log(`Loading slide at ${e}`);let i=await this.xhrPromise(`${e}/manifest.json`,"GET","JSON"),s=JSON.parse(i),a=s.name;(""===a||void 0===a)&&(a=`slide${t}`),this.slides[a]={},this.slides[a].name=a,this.slides[a].position=t,this.slides[a].loadCount=0,this.slides[a].isReady=!1;let n=document.createElement("article");n.classList.add("page"),this.slides[a].article=n,this.frame.appendChild(n);let l=document.createElement("section");l.classList.add("menu"),l.slide=n;let d=`<b>${s.title}</b>`;""!==s.thumbnail&&(d+=`<br /><img class="right" src="${s.thumbnail}" />`),l.innerHTML=d,l.addEventListener("click",()=>{this.activate(a)}),this.slides[a].menuItem=l,this.loadCSS(`${e}/${s.styles}`,this.slides[a]),this.loadContent(`${e}/${s.main}`,this.slides[a]),this.loadExtra(`${e}/${s.extra}`,this.slides[a])}async loadCSS(e,t){console.log(`${t.name} -> loading CSS`);let i=await this.xhrPromise(e),s=document.createElement("style");s.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(s),++t.loadCount>=2&&(t.isReady=!0)}async loadContent(e,t){console.log(`${t.name} -> loading HTML`);let i=await this.xhrPromise(e,"GET","DOCUMENT");t.article.innerHTML=i,this.slideOrder.splice(t.position,0,t.name),this.menu.appendChild(t.menuItem),this.maxSlide=this.slideOrder.length-1,++t.loadCount>=2&&(t.isReady=!0,0==t.position&&this.activate(t.name))}async loadExtra(e,t){console.log(`${t.name} -> loading extra panel`);let i=await this.xhrPromise(e,"GET","DOCUMENT"),s=document.createElement("aside");s.classList.add("extra"),s.innerHTML=i,t.article.appendChild(s),this.extraOffset>2e3&&(s.style.left=`${this.extraOffset}px`)}activate(e){if(this.slides[e].isReady){for(let t in this.slideOrder)this.slideOrder[t]!=e&&(this.slides[this.slideOrder[t]].menuItem.classList.remove("active"),this.slides[this.slideOrder[t]].article.classList.remove("active"));this.slides[e].menuItem.classList.add("active"),this.slides[e].article.classList.add("active"),this.activeSlide=e}else console.log(`Slide ${e} isn't yet finished loading`)}advance(){let e=this.slideOrder.indexOf(this.activeSlide),t=e>this.maxSlide-1?0:+e+1;this.activate(this.slideOrder[t])}previous(){let e=this.slideOrder.indexOf(this.activeSlide),t=e<1?this.maxSlide:e-1;this.activate(this.slideOrder[t])}autoplay(e){this.intervalSeconds=Math.round(e/1e3),this.runCountdown(),this.autoHandle=setInterval(()=>{this.advance(),this.runCountdown()},e),this.isAutoPlaying=!0}runCountdown(){clearInterval(this.countdownHandle),this.countdown=this.intervalSeconds,this.menuHead.innerHTML=`Poster outline <font style="color: red;">(auto-playing: ${this.countdown})</font>`,this.countdownHandle=setInterval(()=>{this.countdown-=1,this.menuHead.innerHTML=`Poster outline <font style="color: red;">(auto-playing: ${this.countdown})</font>`},1e3)}stop(){clearInterval(this.countdownHandle),clearInterval(this.autoHandle),this.menuHead.innerHTML="Poster outline",this.isAutoPlaying=!1,this.countdown=0}resize(e=window.innerWidth,t=window.innerHeight){let i=Math.min(...[e/this.width,t/this.height]);this.frame.style.transform=`scale(${i})`,this.isRealSize=!1}realSize(){this.frame.style.transform="scale(1)",this.isRealSize=!0}toggleExtra(){this.slides[this.activeSlide].article.classList.contains("inExtra")?(this.slides[this.activeSlide].article.style.transform="translateX(0) translateZ(0)",this.slides[this.activeSlide].article.classList.remove("inExtra")):(this.slides[this.activeSlide].article.style.transform=`translateX(-${this.extraOffset}px) translateZ(0)`,this.slides[this.activeSlide].article.classList.add("inExtra"))}xhrPromise(e,t="GET",i="text",...s){return new Promise(function(a,n){let l=new XMLHttpRequest;l.open(t,e,!0),s.length>0&&l.setRequestHeader(...s),l.responseType=i,l.onload=function(){a(this.responseText)},l.onerror=function(){n({status:this.status,statusText:l.statusText})},l.send(null)})}}